<!DOCTYPE html>
<html>
<head>
  <title>Favicon Generator - SM & G</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      padding: 40px;
      background: #1a1a1a;
      color: #fff;
      font-family: system-ui, sans-serif;
      min-height: 100vh;
    }
    h1 {
      font-family: 'Bebas Neue', Impact, sans-serif;
      font-size: 3rem;
      background: linear-gradient(135deg, #ff4d00, #ffaa00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .variant {
      background: #252525;
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #333;
    }
    .variant h2 {
      margin: 0 0 20px;
      font-family: 'Bebas Neue', Impact, sans-serif;
      font-size: 1.5rem;
      color: #ccc;
    }
    .preview {
      display: flex;
      gap: 24px;
      align-items: flex-end;
      margin-bottom: 20px;
    }
    .preview-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .preview-item span {
      font-size: 12px;
      color: #666;
    }
    canvas {
      /* Checkerboard pattern to show transparency */
      background: repeating-conic-gradient(#333 0% 25%, #444 0% 50%) 50% / 8px 8px;
      border-radius: 4px;
    }
    .buttons {
      display: flex;
      gap: 12px;
    }
    button {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff4d00, #ffaa00);
      border: none;
      color: #0c0c0c;
      font-weight: 700;
      cursor: pointer;
      border-radius: 6px;
      font-size: 14px;
      transition: transform 0.15s, opacity 0.15s;
    }
    button:hover {
      transform: translateY(-2px);
      opacity: 0.95;
    }
    button:active {
      transform: translateY(0);
    }
    .instructions {
      max-width: 500px;
      text-align: center;
      color: #666;
      line-height: 1.6;
      font-size: 14px;
    }
    code {
      background: #333;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }
    .browser-preview {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }
    .browser-preview img {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      background: #0c0c0c;
      padding: 8px;
    }
  </style>
</head>
<body>
  <h1>FAVICON GENERATOR</h1>

  <div class="variant" id="variant-sm">
    <h2>"SM" VARIANT</h2>
    <div class="preview">
      <div class="preview-item">
        <canvas id="sm-64" width="64" height="64"></canvas>
        <span>64px</span>
      </div>
      <div class="preview-item">
        <canvas id="sm-48" width="48" height="48"></canvas>
        <span>48px</span>
      </div>
      <div class="preview-item">
        <canvas id="sm-32" width="32" height="32"></canvas>
        <span>32px</span>
      </div>
      <div class="preview-item">
        <canvas id="sm-16" width="16" height="16"></canvas>
        <span>16px</span>
      </div>
    </div>
    <div class="buttons">
      <button onclick="downloadIco('SM')">Download SM.ico</button>
      <button onclick="downloadPng('SM', 64)">Download PNG</button>
    </div>
  </div>

  <div class="variant" id="variant-g">
    <h2>"G" VARIANT</h2>
    <div class="preview">
      <div class="preview-item">
        <canvas id="g-64" width="64" height="64"></canvas>
        <span>64px</span>
      </div>
      <div class="preview-item">
        <canvas id="g-48" width="48" height="48"></canvas>
        <span>48px</span>
      </div>
      <div class="preview-item">
        <canvas id="g-32" width="32" height="32"></canvas>
        <span>32px</span>
      </div>
      <div class="preview-item">
        <canvas id="g-16" width="16" height="16"></canvas>
        <span>16px</span>
      </div>
    </div>
    <div class="buttons">
      <button onclick="downloadIco('G')">Download G.ico</button>
      <button onclick="downloadPng('G', 64)">Download PNG</button>
    </div>
  </div>

  <p class="instructions">
    Download your preferred favicon and place it at<br>
    <code>frontend/src/favicon.ico</code>
  </p>

  <script>
    const sizes = [64, 48, 32, 16];
    const gradientStart = '#ff4d00';
    const gradientEnd = '#ffaa00';

    function drawFavicon(ctx, size, text) {
      // Clear with transparency
      ctx.clearRect(0, 0, size, size);

      // Create gradient for text
      const gradient = ctx.createLinearGradient(0, 0, size, size);
      gradient.addColorStop(0, gradientStart);
      gradient.addColorStop(1, gradientEnd);

      ctx.fillStyle = gradient;

      // Measure and scale to fill the canvas tightly
      // Start with a large font size and measure
      let testSize = size * 2;
      ctx.font = `${testSize}px "Bebas Neue", Impact, sans-serif`;
      let metrics = ctx.measureText(text);

      // Get actual text dimensions
      const textWidth = metrics.width;
      const textHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;

      // Scale to fit - use whichever dimension is the constraint
      const scaleX = size / textWidth;
      const scaleY = size / textHeight;
      const scale = Math.min(scaleX, scaleY);

      // Apply the calculated font size
      const fontSize = testSize * scale;
      ctx.font = `${fontSize}px "Bebas Neue", Impact, sans-serif`;

      // Re-measure with final size
      metrics = ctx.measureText(text);
      const finalHeight = metrics.actualBoundingBoxAscent;

      // Center horizontally and vertically
      const x = size / 2;
      const y = (size + finalHeight) / 2;

      ctx.textAlign = 'center';
      ctx.textBaseline = 'alphabetic';
      ctx.fillText(text, x, y);
    }

    function renderAll() {
      ['SM', 'G'].forEach(text => {
        sizes.forEach(size => {
          const canvas = document.getElementById(`${text.toLowerCase()}-${size}`);
          if (canvas) {
            drawFavicon(canvas.getContext('2d'), size, text);
          }
        });
      });
    }

    // Wait for font to load
    document.fonts.ready.then(renderAll);
    // Also try after a delay as backup
    setTimeout(renderAll, 500);

    function downloadIco(text) {
      const pngBuffers = sizes.map(size => {
        const canvas = document.getElementById(`${text.toLowerCase()}-${size}`);
        const dataUrl = canvas.toDataURL('image/png');
        const base64 = dataUrl.split(',')[1];
        const binary = atob(base64);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) {
          bytes[i] = binary.charCodeAt(i);
        }
        return bytes;
      });

      const icoData = buildIco(pngBuffers);
      const blob = new Blob([icoData], { type: 'image/x-icon' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `favicon-${text.toLowerCase()}.ico`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function downloadPng(text, size) {
      const canvas = document.getElementById(`${text.toLowerCase()}-${size}`);
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = `favicon-${text.toLowerCase()}-${size}.png`;
      a.click();
    }

    function buildIco(pngBuffers) {
      const numImages = pngBuffers.length;
      const headerSize = 6;
      const dirEntrySize = 16;
      const dirSize = dirEntrySize * numImages;

      let totalSize = headerSize + dirSize;
      const imageOffsets = [];

      for (const buf of pngBuffers) {
        imageOffsets.push(totalSize);
        totalSize += buf.length;
      }

      const ico = new Uint8Array(totalSize);
      const view = new DataView(ico.buffer);
      let offset = 0;

      // Header
      view.setUint16(offset, 0, true); offset += 2;
      view.setUint16(offset, 1, true); offset += 2;
      view.setUint16(offset, numImages, true); offset += 2;

      // Directory entries
      sizes.forEach((size, i) => {
        view.setUint8(offset, size === 256 ? 0 : size); offset += 1;
        view.setUint8(offset, size === 256 ? 0 : size); offset += 1;
        view.setUint8(offset, 0); offset += 1;
        view.setUint8(offset, 0); offset += 1;
        view.setUint16(offset, 1, true); offset += 2;
        view.setUint16(offset, 32, true); offset += 2;
        view.setUint32(offset, pngBuffers[i].length, true); offset += 4;
        view.setUint32(offset, imageOffsets[i], true); offset += 4;
      });

      // Image data
      for (const buf of pngBuffers) {
        ico.set(buf, offset);
        offset += buf.length;
      }

      return ico;
    }
  </script>
</body>
</html>
